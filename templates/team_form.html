{% extends 'base_form.html' %}

{% block head %}
  {{super()}}
  <script>
    const emails = [
        {%- for email in emails -%}
            "{{ email }}",
        {%- endfor -%}
    ]
  </script>
  <script src="{{url_for('static', filename='js/team_request.js')}}"></script>
{% endblock head %}

{% block title %}
  {% if edit %}
    Изменение команды
  {% else %}
    Заявка - {{tour.title}}
  {% endif %}
{% endblock title %}

{% block form %}
  <form
    class="form form_team"
    method="post"
    autocomplete="off"
  >
    {{form.hidden_tag()}}
    <fieldset class="form__fields">
      {{form_field(form.name)}}
        {{form.name.label(for="title_field", class="form__field-label")}}
        {{form.name(
          type="text",
          class="form__field-input",
          autocomplete="off"
        )}}
        {{field_errors(form.name)}}
      </div>
      {{form_field(form.motto)}}
        {{form.motto.label(class="form__field-label")}}
        {{form.motto(
          class="form__field-input",
          autocomplete="off"
        )}}
        {{field_errors(form.motto)}}
      </div>

      <div>
        {% set additional_info_fields = ['surname', 'name', 'patronymic', 'city', 'birthday'] %}

        <template id="user_email_field">
          <li class="form__field players-li">
            <fieldset id="players-{}-fieldset container">
              <div class="row">

                <label class="col-sm" for="players-{}-email">
                  Электронная почта
                </label>
                <input
                    class=" players-email col-sm"
                    id="players-{}-email"
                    name="players-{}-email"
                    onchange="onChangePlayerEmail(this)"
                    oninput="onInputPlayerEmail(this)"
                >
              </div>
              <fieldset class="players-additional_info" id="players-{}-additional_info" disabled>
                {% for field_name in additional_info_fields %}
                  <div class="row">
                  <label class="col-sm" for="players-{}-{{ field_name }}">
                    {{ field_name }}
                  </label>
                  <input class="players-{{ field_name }} col-sm {%- if field_name == "birthday" %} datepicker-here {%- endif -%}"
                         id="players-{}-{{ field_name }}"
                         name="players-{}-{{ field_name }}"
                         {% if field_name == "birthday" -%}
                           data-position="right top"
                         {%- endif -%}
                         {% if field_name in form.players.unbound_field.__required_if_new -%}
                           required
                         {%- endif -%}
                  >
                  </div>
                {% endfor %}
              </fieldset>
            </fieldset>
          </li>
        </template>
        {{form.players.label(class="form__field-label")}}
        <ul class="form__field-list shadow_list" id="players">
        </ul>
      </div>
      <button onclick="addUserEmailField()" type="button">+</button>
      <button onclick="deleteUserEmailField()" type="button">-</button>
      {{message}}
      <div class="form__buttons s-buttons">
        {{form.submit(
          type="submit",
          id="registration_button",
          class="button button_wide button_primary"
        )}}
      </div>
    </fieldset>
  </form>
  
{% endblock form %}